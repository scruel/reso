(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5628:(e,t,s)=>{Promise.resolve().then(s.bind(s,9327))},9327:(e,t,s)=>{"use strict";let a;s.r(t),s.d(t,{default:()=>O});var r=s(5155),l=s(2115),n=s(4416),i=s(9881),o=s(7924),c=s(3311),d=s(2596),u=s(9688);function h(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,u.QP)((0,d.$)(t))}function m(e){let t=[...e];for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}function g(e){let{onSearch:t,onReset:s,isSearching:a,hasSearched:d,query:u}=e,[m,g]=(0,l.useState)(u),[x,p]=(0,l.useState)(!1),b=(0,l.useRef)(null);return(0,l.useEffect)(()=>{g(u)},[u]),(0,r.jsxs)("div",{className:h("transition-all duration-800 ease-out",d?"fixed bottom-16 left-1/2 transform -translate-x-1/2 z-[25] w-11/12 max-w-2xl":"fixed top-[45%] left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 w-11/12 max-w-2xl"),children:[(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),m.trim()&&t(m.trim())},className:"relative group",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{ref:b,type:"text",value:m,onChange:e=>{let s=e.target.value;g(s),d&&t(s)},onFocus:()=>p(!0),onBlur:()=>p(!1),placeholder:"Text whatever you want",className:h("w-full pl-8 pr-24 py-4","bg-white","border border-gray-200","rounded-[2rem]","shadow-lg","text-gray-900 placeholder-gray-500","transition-all duration-300",x&&"scale-[1.015] outline-none ring-0 shadow-xl"),disabled:a}),(m||d)&&(0,r.jsx)("button",{type:"button",onClick:()=>{var e;g(""),s(),null==(e=b.current)||e.focus()},className:"absolute right-16 top-1/2 transform -translate-y-1/2 p-1 rounded-full hover:bg-gray-100 transition-colors",title:"清除",children:(0,r.jsx)(n.A,{className:"w-4 h-4 text-gray-400"})}),(0,r.jsx)("button",{type:"submit",disabled:a&&!u.trim(),className:h("absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10","rounded-full bg-black","flex items-center justify-center text-white","hover:bg-gray-800 transition-all duration-200"),children:a?(0,r.jsx)(n.A,{className:"w-5 h-5"}):u.trim()?(0,r.jsx)(i.A,{className:"w-5 h-5"}):(0,r.jsx)(o.A,{className:"w-5 h-5"})})]}),!d&&(0,r.jsxs)("div",{className:"mt-6 text-center animate-fade-in",children:[(0,r.jsx)("div",{className:"flex flex-wrap justify-center gap-2 text-sm",children:["iPhone","MacBook","筆電","耳機","智慧手錶","相機"].map(e=>(0,r.jsx)("button",{type:"button",onClick:()=>{g(e),t(e)},className:"px-3 py-1.5 bg-white/60 backdrop-blur-sm text-gray-600 rounded-full hover:bg-white/80 hover:text-gray-900 transition-all duration-200 border border-gray-200/50",children:e},e))}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-4",children:"或試試搜尋“智慧家居”、“遊戲主機”、“咖啡機”"})]})]}),a&&d&&(0,r.jsx)("div",{className:"mt-3 text-center",children:(0,r.jsxs)("div",{className:"inline-flex items-center space-x-2 text-sm text-gray-600",children:[(0,r.jsx)("div",{className:"animate-spin",children:(0,r.jsx)(c.A,{className:"w-4 h-4"})}),(0,r.jsx)("span",{children:"正在搜尋中..."})]})})]})}var x=s(6766),p=s(5695),b=s(7383);function f(e){let{thread:t,delay:a=0}=e,[n,i]=(0,l.useState)(!1),[o,c]=(0,l.useState)(!1),[d,u]=(0,l.useState)(void 0),h=(0,l.useRef)(null);(0,p.useRouter)();let m=t.good.categoryColor||"#6B7280";return(0,l.useEffect)(()=>{if(!h.current)return;let e=()=>{h.current&&u(h.current.offsetWidth)};e();let t=new ResizeObserver(e);return t.observe(h.current),()=>t.disconnect()},[]),(0,r.jsx)("div",{ref:h,className:"w-full group cursor-pointer animate-fade-in transition-transform hover:scale-[1.015]",style:{animationDelay:"".concat(a,"ms")},onClick:()=>{console.log("ProductCard clicked, navigating to thread:",t.id);let e=b.A.get("reso_user_uuid")||"anonymous",a=parseFloat(t.good.price)||0,r="用戶 ".concat(e,' 點擊了商品 "').concat(t.good.title,'" (品牌: ').concat(t.good.brand,", 價格: $").concat(a.toFixed(0),")");console.log("\uD83D\uDC46 ".concat(r)),Promise.resolve().then(s.bind(s,5731)).then(e=>{let{getApiUrl:t}=e;fetch(t("/api/log-click"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:r})}).catch(()=>{})}),window.location.href="/product/".concat(t.id)},children:(0,r.jsxs)("div",{className:"rounded-2xl overflow-visible",children:[(0,r.jsxs)("div",{className:"rounded-2xl bg-white/50 backdrop-blur-sm shadow-sm hover:shadow-lg transition-shadow duration-300 relative z-50",children:[(0,r.jsxs)("div",{className:"w-full h-full flex items-center justify-center text-6xl text-gray-300",children:[o?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-6xl text-gray-300",children:"\uD83D\uDCE6"}):(0,r.jsx)(x.default,{src:t.good.pic_url,alt:t.good.title,width:600,height:600,className:"w-full h-auto object-cover transition-all duration-500 group-hover:scale-105 ".concat(n?"opacity-100":"opacity-0"),onLoad:()=>i(!0),onError:()=>c(!0)}),!n&&!o&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 animate-pulse"})]}),(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-[11px] font-medium px-2 py-0.5 rounded",style:{color:m,backgroundColor:"".concat(m,"15")},children:t.good.category}),(0,r.jsx)("span",{className:"text-[11px] text-gray-500",children:t.good.brand})]}),(0,r.jsx)("h3",{className:"product-title mb-2 text-sm font-medium text-gray-900 group-hover:text-primary-600 transition-colors line-clamp-2",children:t.good.title}),(0,r.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,r.jsxs)("span",{className:"text-base font-semibold text-gray-700",children:["$",parseFloat(t.good.price).toFixed(2)]})})]})]}),t.dchain&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mx-auto w-px h-4 relative animate-fade-in",style:{backgroundColor:"".concat(m,"80"),animationDelay:"".concat(a,"ms")},children:(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1.5 h-1.5 rounded-full animate-fade-in",style:{backgroundColor:m,animationDelay:"".concat(a,"ms")}})}),(0,r.jsxs)("div",{className:"bg-white/50 backdrop-blur-sm rounded-2xl shadow-sm group-hover:shadow-lg transition-shadow duration-300 overflow-hidden animate-fade-in relative",style:{animationDelay:"".concat(a,"ms")},children:[(0,r.jsx)("img",{src:t.dchain.tbn_url,alt:"".concat(t.good.title," 流程示意"),className:"w-full h-auto object-cover"}),(0,r.jsxs)("div",{className:"absolute bottom-2 right-2 flex items-center gap-1.5 bg-white/90 backdrop-blur-sm rounded-full px-2 py-1 shadow-sm",children:[(0,r.jsx)("div",{className:"w-5 h-5 rounded-full bg-gradient-to-br from-sky-400 to-blue-500 flex items-center justify-center text-white text-xs font-medium",children:t.dchain.user_nick?t.dchain.user_nick.charAt(0).toUpperCase():"A"}),(0,r.jsx)("span",{className:"text-xs font-medium text-gray-700 pr-1",children:t.dchain.user_nick||"Anonymous"})]})]})]})]})})}function v(e){let{delay:t=0}=e;return(0,r.jsxs)("div",{className:"product-card animate-pulse",style:{animationDelay:"".concat(t,"ms")},children:[(0,r.jsx)("div",{className:"aspect-square rounded-t-2xl bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 bg-[length:200%_100%] animate-pulse"}),(0,r.jsxs)("div",{className:"p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"h-5 w-16 bg-gray-200 rounded-md"}),(0,r.jsx)("div",{className:"h-4 w-12 bg-gray-200 rounded"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"h-4 w-full bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-4 w-3/4 bg-gray-200 rounded"})]}),(0,r.jsx)("div",{className:"h-6 w-20 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-10 w-full bg-gray-200 rounded-xl"})]})]})}function y(e){let{products:t,isLoading:s,searchQuery:a}=e,[n,i]=(0,l.useState)([]),[o,c]=(0,l.useState)(!0),[d,u]=(0,l.useState)(!1),h=(0,l.useRef)(null),m=(0,l.useRef)(null);(0,l.useEffect)(()=>{t.length>0?(i(t.slice(0,30)),c(t.length>30)):(i([]),c(!1))},[t]);let g=(0,l.useCallback)(()=>{!d&&o&&(u(!0),setTimeout(()=>{let e=n.length,s=t.slice(e,e+20);s.length>0?(i(e=>[...e,...s]),c(e+s.length<t.length)):c(!1),u(!1)},800))},[n.length,t,d,o]);return((0,l.useEffect)(()=>(h.current&&h.current.disconnect(),h.current=new IntersectionObserver(e=>{e[0].isIntersecting&&o&&!d&&g()},{threshold:.1}),m.current&&h.current.observe(m.current),()=>{h.current&&h.current.disconnect()}),[o,d,g]),s&&0===n.length)?(0,r.jsx)("div",{className:"columns-1 sm:columns-2 md:columns-3 lg:columns-4 gap-6",children:Array.from({length:30}).map((e,t)=>(0,r.jsx)("div",{className:"mb-6 break-inside-avoid",children:(0,r.jsx)(v,{delay:50*t})},t))}):s||0!==n.length?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"columns-1 sm:columns-2 md:columns-3 lg:columns-4 gap-6",children:n.map((e,t)=>(0,r.jsx)("div",{className:"mb-6 break-inside-avoid","data-thread-id":e.id,children:(0,r.jsx)(f,{thread:e,delay:30*t})},e.id))}),o&&(0,r.jsx)("div",{ref:m,className:"flex justify-center py-8",children:d?(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,r.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-2 border-orange-500 border-t-transparent"}),(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"加載中..."})]}):(0,r.jsx)("div",{className:"text-gray-400 text-sm",children:"向下滾動查看更多商品"})}),!o&&n.length>30&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-gray-500 text-sm",children:"\uD83C\uDF89 所有商品已加載完成"}),(0,r.jsxs)("p",{className:"text-gray-400 text-xs mt-1",children:["共 ",n.length," 個商品"]})]})]}):(0,r.jsxs)("div",{className:"text-center py-20",children:[(0,r.jsx)("span",{className:"text-2xl text-gray-400",children:"\uD83D\uDD0D"}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mt-2",children:"沒有找到符合的商品"}),a&&(0,r.jsx)("p",{className:"text-gray-500 mt-1",children:"試試使用不同的關鍵字"})]})}var j=s(6739),w=s(1368),N=s(5731);(0,N.getApiUrl)("/api/client-log");let C="reso_session",k=[],_=async()=>{k.length&&fetch((0,N.getApiUrl)("/api/client-log"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k.splice(0))}).catch(()=>{})},A=(e,t)=>{let s=(()=>{let e=b.A.get(C);return e||(e=(0,w.A)(),b.A.set(C,e,{expires:365,sameSite:"Lax"})),e})(),r="";switch(e){case"pageview":r="用戶 ".concat(s," 瀏覽了頁面");break;case"scroll":r="用戶 ".concat(s," 滾動到 ").concat((null==t?void 0:t.depth)||0,"% 位置");break;case"click":r="用戶 ".concat(s," 點擊了商品 ").concat((null==t?void 0:t.productId)||"未知");break;case"hover":r="用戶 ".concat(s," 懸停在商品 ").concat((null==t?void 0:t.productId)||"未知"," 上");break;case"search":r="用戶 ".concat(s,' 搜索了 "').concat((null==t?void 0:t.query)||"空搜索",'"');break;default:r="用戶 ".concat(s," 執行了 ").concat(e," 操作")}console.log("\uD83D\uDCCA ".concat(r)),k.push({message:r}),clearTimeout(a),a=setTimeout(_,5e3)};var S=s(9137),D=s.n(S),I=s(2915),E=s(8533),P=s(311),L=s(1284);function T(e){let{status:t,message:s,show:a,onClose:i,autoClose:o=!0,duration:c=5e3}=e,[d,u]=(0,l.useState)(a);(0,l.useEffect)(()=>{if(u(a),a&&o){let e=setTimeout(()=>{h()},c);return()=>clearTimeout(e)}},[a,o,c]);let h=()=>{u(!1),setTimeout(()=>{i()},300)};if(!a)return null;let m=t>=200&&t<300?{icon:I.A,bgColor:"bg-green-50",borderColor:"border-green-200",iconColor:"text-green-500",titleColor:"text-green-800",textColor:"text-green-700"}:t>=400&&t<500?{icon:E.A,bgColor:"bg-yellow-50",borderColor:"border-yellow-200",iconColor:"text-yellow-500",titleColor:"text-yellow-800",textColor:"text-yellow-700"}:t>=500?{icon:P.A,bgColor:"bg-red-50",borderColor:"border-red-200",iconColor:"text-red-500",titleColor:"text-red-800",textColor:"text-red-700"}:{icon:L.A,bgColor:"bg-blue-50",borderColor:"border-blue-200",iconColor:"text-blue-500",titleColor:"text-blue-800",textColor:"text-blue-700"},g=m.icon;return(0,r.jsxs)("div",{className:"jsx-e43ea6c4bca847b0 fixed inset-0 z-[9999] flex items-start justify-center pt-20 px-4",children:[(0,r.jsx)("div",{onClick:h,className:"jsx-e43ea6c4bca847b0 "+"fixed inset-0 bg-black transition-opacity duration-300 ".concat(d?"bg-opacity-20":"bg-opacity-0")}),(0,r.jsxs)("div",{className:"jsx-e43ea6c4bca847b0 "+"\n        relative bg-white rounded-lg shadow-lg border-2 p-6 max-w-md w-full\n        transform transition-all duration-300 ease-out\n        ".concat(m.bgColor," ").concat(m.borderColor,"\n        ").concat(d?"translate-y-0 opacity-100 scale-100":"-translate-y-4 opacity-0 scale-95","\n      "),children:[(0,r.jsx)("button",{onClick:h,className:"jsx-e43ea6c4bca847b0 absolute top-4 right-4 p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,r.jsx)(n.A,{className:"w-4 h-4 text-gray-400"})}),(0,r.jsxs)("div",{className:"jsx-e43ea6c4bca847b0 flex items-start space-x-3",children:[(0,r.jsx)(g,{className:"jsx-e43ea6c4bca847b0 "+"w-6 h-6 mt-0.5 ".concat(m.iconColor)}),(0,r.jsxs)("div",{className:"jsx-e43ea6c4bca847b0 flex-1",children:[(0,r.jsxs)("div",{className:"jsx-e43ea6c4bca847b0 flex items-center space-x-2 mb-2",children:[(0,r.jsx)("h3",{className:"jsx-e43ea6c4bca847b0 "+"font-medium ".concat(m.titleColor),children:t>=200&&t<300?"成功":t>=400&&t<500?"客户端错误":t>=500?"服务器错误":"信息"}),(0,r.jsx)("span",{className:"jsx-e43ea6c4bca847b0 "+"text-sm px-2 py-0.5 rounded-full bg-gray-100 ".concat(m.textColor),children:t})]}),(0,r.jsx)("p",{className:"jsx-e43ea6c4bca847b0 "+"text-sm ".concat(m.textColor," leading-relaxed"),children:s})]})]}),o&&(0,r.jsx)("div",{className:"jsx-e43ea6c4bca847b0 mt-4 w-full bg-gray-200 rounded-full h-1",children:(0,r.jsx)("div",{style:{width:"100%",animation:"shrink ".concat(c,"ms linear")},className:"jsx-e43ea6c4bca847b0 "+"h-1 rounded-full transition-all ease-linear ".concat(t>=200&&t<300?"bg-green-500":t>=400&&t<500?"bg-yellow-500":t>=500?"bg-red-500":"bg-blue-500")})})]}),(0,r.jsx)(D(),{id:"e43ea6c4bca847b0",children:"@keyframes shrink{from{width:100%}to{width:0%}}"})]})}function z(){let[e,t]=(0,l.useState)({isSearching:!1,hasSearched:!1,query:"",results:[]}),{items:a,hasMore:n,lastRef:i}=(()=>{let[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(1),[r,n]=(0,l.useState)(!0),i=(0,l.useRef)(null);return{items:e,hasMore:r,lastRef:e=>{i.current&&i.current.disconnect(),i.current=new IntersectionObserver(e=>{e[0].isIntersecting&&(()=>{if(!r)return;let e=(s-1)*20,l=e+20,i=j.C.slice(e,l);t(e=>[...e,...i]),a(e=>e+1),n(l<j.C.length)})()},{threshold:.5}),e&&i.current.observe(e)}}})(),{statusMessage:o,showStatusMessage:c,hideStatusMessage:d,showError:u,showSuccess:h}=function(){let[e,t]=(0,l.useState)({status:0,message:"",show:!1}),s=(0,l.useCallback)((e,s)=>{t({status:e,message:s,show:!0})},[]),a=(0,l.useCallback)(()=>{t(e=>({...e,show:!1}))},[]),r=(0,l.useCallback)(e=>{s(200,e)},[s]),n=(0,l.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;s(t,e)},[s]),i=(0,l.useCallback)(e=>{s(400,e)},[s]),o=(0,l.useCallback)(e=>{s(0,e)},[s]);return{statusMessage:e,showStatusMessage:s,hideStatusMessage:a,showSuccess:r,showError:n,showWarning:i,showInfo:o}}();(0,l.useEffect)(()=>{let e;A("pageview"),e=0,window.addEventListener("scroll",()=>{let t=Math.round((window.scrollY+window.innerHeight)/document.documentElement.scrollHeight*100);t>e&&(e=t,A("scroll",{depth:t}))},{passive:!0}),document.addEventListener("click",e=>{let t=e.target.closest("[data-product-id]");t&&A("click",{productId:t.getAttribute("data-product-id")})}),document.addEventListener("mouseover",e=>{let t=e.target.closest("[data-product-id]");t&&!t.matches("[data-hover-sent]")&&(t.setAttribute("data-hover-sent","1"),A("hover",{productId:t.getAttribute("data-product-id")}))}),document.addEventListener("search-log",e=>{A("search",{query:e.detail})}),window.addEventListener("beforeunload",_)},[]);let[x,p]=(0,l.useState)([]),[f,v]=(0,l.useState)(""),N=(e=>{let t=(null==e?void 0:e.toLowerCase())||"";return t.includes("手機")||t.includes("phone")||t.includes("iphone")?["AI正在分析您對智慧型手機的偏好與需求...","基於您的搜索歷史，為您推薦最適合的手機型號...","正在比較不同品牌手機的規格與性價比...","根據您的使用習慣，篩選出最符合需求的手機產品..."]:t.includes("耳機")||t.includes("headphone")||t.includes("airpods")?["AI正在分析您的音樂偏好與聆聽習慣...","根據您的需求，為您推薦最適合的音頻設備...","正在比較不同耳機的音質表現與降噪效果...","基於您的使用場景，篩選最合適的耳機產品..."]:t.includes("筆電")||t.includes("laptop")||t.includes("macbook")?["AI正在分析您對筆記型電腦的性能需求...","根據您的工作類型，為您推薦最適合的筆電配置...","正在比較不同品牌筆電的規格與續航表現...","基於您的預算與需求，篩選最合適的筆電產品..."]:t.includes("遊戲")||t.includes("gaming")||t.includes("switch")?["AI正在分析您的遊戲偏好與遊玩習慣...","根據您喜愛的遊戲類型，為您推薦最適合的遊戲設備...","正在比較不同遊戲平台的獨占遊戲與性能表現...","基於您的遊戲需求，篩選最合適的娛樂設備..."]:["AI正在分析您的購物偏好與需求...","根據您的搜索意圖，為您推薦最適合的產品...","正在比較不同產品的品質與性價比...","基於您的需求，篩選最符合期望的商品..."]})(f),[C,k]=(0,l.useState)(0),[S,D]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{try{let e=await Promise.resolve().then(s.bind(s,5731)).then(e=>{let{apiGet:t}=e;return t("/api/products")});if(e&&(e.threads||e.threas)&&Array.isArray(e.threads||e.threas)){let t=e.threads||e.threas,s=t.map(e=>{var t,s,a,r,l,n,i;return{id:e.id,good:{id:(null==(t=e.good)?void 0:t.id)||e.id,title:(null==(s=e.good)?void 0:s.title)||e.title||"Unknown Product",pic_url:(null==(a=e.good)?void 0:a.pic_url)||e.pic_url||"/placeholder.jpg",brand:(null==(r=e.good)?void 0:r.brand)||e.brand||"Unknown Brand",category:(null==(l=e.good)?void 0:l.category)||e.category||"General",categoryColor:(null==(n=e.good)?void 0:n.categoryColor)||"#6B7280",price:(null==(i=e.good)?void 0:i.price)||e.price||"0"},dchain:e.dchain&&"object"==typeof e.dchain?{tbn_url:e.dchain.tbn_url||"/images/phone-search-flowchart.png",user_nick:e.dchain.user_nick||"Anonymous",user_pic_url:e.dchain.user_pic_url||""}:{tbn_url:"/images/phone-search-flowchart.png",user_nick:"Anonymous",user_pic_url:""}}});if(s.length<30){let e=j.C.slice(0,30-s.length);s=[...s,...e],console.log("\uD83D\uDCE6 Backend returned ".concat(t.length," products, filled with ").concat(e.length," mock products to reach 30"))}p(m(s)),console.log("\uD83D\uDE80 Initialized with ".concat(s.length," products (backend + mock fill)"))}else p(m(j.C)),console.log("\uD83D\uDD04 Initialized with mock data - backend not available")}catch(e){console.error("Failed to load initial products:",e),u("后端连接失败，使用模拟数据",500),p(m(j.C)),console.log("\uD83D\uDD04 Initialized with mock data - backend error")}})()},[]),(0,l.useEffect)(()=>{let e=setInterval(()=>{k(e=>(e+1)%N.length)},5e3);return()=>clearInterval(e)},[]),(0,l.useEffect)(()=>{S&&!S.message&&D(e=>e?{...e,message:""}:null)},[C,S]);let I=()=>{let e="reso_user_uuid",t=b.A.get(e);return t||(t=(0,w.A)(),b.A.set(e,t,{expires:365,sameSite:"Lax",secure:"https:"===window.location.protocol})),t},E=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=I(),r=t.query||"",l=r?"用戶 ".concat(a,' 搜索了 "').concat(r,'"'):"用戶 ".concat(a," 執行了空搜索");console.log("\uD83D\uDD0D ".concat(l));try{return Promise.resolve().then(s.bind(s,5731)).then(e=>{let{getApiUrl:t}=e;fetch(t("/api/vibe"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuid:a,query:r})}).then(e=>e.json()).then(e=>{0===e.status&&D(e)}).catch(()=>{})}),a}catch(e){return null}},P=async e=>{t(t=>({...t,query:e,hasSearched:!0,isSearching:!0})),v(e);try{I(),console.log("\uD83D\uDD0D 调用后端 vibe API，查询:",e.trim()||"精選商品");let l=await Promise.resolve().then(s.bind(s,5731)).then(t=>{let{apiGet:s}=t;return s("/api/vibe?query=".concat(encodeURIComponent(e.trim()||"精選商品")))});if(console.log("\uD83D\uDCE1 后端 vibe API 原始响应:",l),l&&0===l.status){var a,r;let e={intent:{title:(null==(a=l.intent)?void 0:a.title)||"精選商品",attrs:(null==(r=l.intent)?void 0:r.attrs)||[],pic_url:"/images/phone-search-flowchart.png"},message:l.message||"為您推薦相關商品",status:0};D(e),console.log("✅ 使用后端AI意图识别结果（已适配）:",e)}else l&&0!==l.status?(console.log("❌ 后端 vibe API 错误:",l),u(l.message||"AI意图识别失败",l.status)):console.log("⚠️ 后端 vibe API 未返回有效响应:",l);let n=await Promise.resolve().then(s.bind(s,5731)).then(e=>{let{apiGet:t}=e;return t("/api/products")});n&&n.status&&0!==n.status&&u(n.message||"获取产品列表失败",n.status);let i=j.C;if(n&&(n.threads||n.threas)&&Array.isArray(n.threads||n.threas)&&(i=(n.threads||n.threas).map(e=>{var t,s,a,r,l,n,i;return{id:e.id,good:{id:(null==(t=e.good)?void 0:t.id)||e.id,title:(null==(s=e.good)?void 0:s.title)||e.title||"Unknown Product",pic_url:(null==(a=e.good)?void 0:a.pic_url)||e.pic_url||"/placeholder.jpg",brand:(null==(r=e.good)?void 0:r.brand)||e.brand||"Unknown Brand",category:(null==(l=e.good)?void 0:l.category)||e.category||"General",categoryColor:(null==(n=e.good)?void 0:n.categoryColor)||"#6B7280",price:(null==(i=e.good)?void 0:i.price)||e.price||"0"},dchain:e.dchain&&"object"==typeof e.dchain?{tbn_url:e.dchain.tbn_url||"/images/phone-search-flowchart.png",user_nick:e.dchain.user_nick||"Anonymous",user_pic_url:e.dchain.user_pic_url||""}:{tbn_url:"/images/phone-search-flowchart.png",user_nick:"Anonymous",user_pic_url:""}}})).length<30){let e=j.C.slice(0,30-i.length);i=[...i,...e]}if(e.trim()){let s=i.filter(t=>t.good.title.toLowerCase().includes(e.toLowerCase())||t.good.category.toLowerCase().includes(e.toLowerCase())||t.good.brand.toLowerCase().includes(e.toLowerCase()));if(!l||0!==l.status){let t=((e,t)=>{let s=e.toLowerCase();return s.includes("手機")||s.includes("phone")||s.includes("iphone")||s.includes("android")?{intent:{title:"智慧型手機",attrs:["5G連網","高解析相機","快速充電","大容量電池","旗艦處理器","無線充電","防水防塵","多鏡頭系統","AI拍照","臉部辨識","指紋解鎖","螢幕指紋","高刷新率","OLED顯示","立體聲喇叭","遊戲模式"],pic_url:"/images/phone-search-flowchart.png"},message:"AI分析您對「".concat(e,"」的搜尋意圖，為您精選了 ").concat(t," 款最新智慧型手機。這些產品都具備先進的拍照功能、強大的處理性能，以及出色的電池續航力，完美滿足您的日常使用需求。"),status:0}:s.includes("耳機")||s.includes("headphone")||s.includes("airpods")?{intent:{title:"高品質耳機",attrs:["主動降噪","高音質","無線連接","長續航","舒適佩戴","快速配對","通話清晰","運動防汗","環境音模式","觸控操作","語音助手","多設備連接"],pic_url:"/images/phone-search-flowchart.png"},message:"根據您對「".concat(e,"」的搜尋，AI為您推薦 ").concat(t," 款頂級耳機產品。這些耳機都擁有卓越的音質表現、先進的降噪技術，讓您享受純淨的音樂體驗。"),status:0}:s.includes("筆電")||s.includes("laptop")||s.includes("macbook")?{intent:{title:"高效能筆記型電腦",attrs:["輕薄設計","長效電池","高效處理器","大容量記憶體","快速SSD","高解析螢幕","多端口連接","背光鍵盤","指紋辨識","快速開機","靜音散熱","專業顯卡"],pic_url:"/images/phone-search-flowchart.png"},message:"AI理解您對「".concat(e,"」的需求，精選了 ").concat(t," 款專業筆記型電腦。這些產品結合了強大的運算能力與便攜性，適合工作、學習和娛樂等多種使用場景。"),status:0}:s.includes("遊戲")||s.includes("gaming")||s.includes("switch")||s.includes("ps5")?{intent:{title:"遊戲娛樂設備",attrs:["4K遊戲","高幀率","快速載入","多人遊戲","手柄震動","沉浸體驗","豐富遊戲庫","線上對戰","便攜遊戲","大螢幕輸出","雲端存檔","向下相容"],pic_url:"/images/phone-search-flowchart.png"},message:"AI分析了您對「".concat(e,"」的興趣，為您推薦 ").concat(t," 款頂級遊戲設備。這些產品能帶來極致的遊戲體驗，讓您盡情享受各種精彩遊戲。"),status:0}:{intent:{title:"精選商品",attrs:["精選","品質","設計","實用","Premium","Stylish","Modern","Essential"],pic_url:"/images/phone-search-flowchart.png"},message:"為您找到 ".concat(t," 個相關商品，根據您的搜尋「").concat(e,"」為您推薦最適合的選擇。"),status:0}})(e,s.length>0?s.length:i.length);D(t),console.log("\uD83C\uDFAD 使用mock AI意图识别数据:",t)}t(e=>({...e,isSearching:!1,results:m(s)})),p(m(s.length>0?s:i))}else t(e=>({...e,isSearching:!1,results:i})),p(m(i))}catch(e){console.error("Search error:",e),u("搜索过程中发生错误，使用本地数据",500),D({intent:{title:"精選商品",attrs:["精選","品質","設計","實用"],pic_url:"/images/phone-search-flowchart.png"},message:"為您精選 ".concat(j.C.length," 個優質商品。"),status:0}),t(e=>({...e,isSearching:!1,results:j.C})),p(m(j.C))}E("search",{query:e,searchType:e.trim()?"text_search":"empty_search"})};return(0,r.jsxs)(r.Fragment,{children:[o.show&&(0,r.jsx)(T,{status:o.status,message:o.message,show:o.show,onClose:d}),(0,r.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 bg-sky-500 h-12 flex items-center",children:(0,r.jsx)("div",{className:"container mx-auto px-4 flex justify-between items-center",children:(0,r.jsx)("div",{className:"text-white text-xl font-medium tracking-wide",children:"Reso"})})}),(0,r.jsxs)("div",{className:"relative min-h-screen z-20 pt-12",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-100"}),!e.hasSearched&&(0,r.jsx)("div",{className:"relative z-10 pt-32 pb-32 text-center",children:(0,r.jsxs)("div",{className:"animate-fade-in",children:[(0,r.jsx)("h1",{className:"text-5xl md:text-6xl font-light text-gray-900 mb-4 tracking-tight",children:"RESO"}),(0,r.jsx)("p",{className:"text-xl md:text-2xl text-gray-600 mb-12 font-light",children:"由 AI 策劃的現代購物體驗"})]})}),(0,r.jsx)("div",{children:(0,r.jsx)(g,{onSearch:P,onReset:()=>{t({isSearching:!1,hasSearched:!1,query:"",results:[]}),D({intent:{title:"精選商品",attrs:["精選","品質","設計","實用","Premium","Curated","Trending","Best-seller"],pic_url:"/images/phone-search-flowchart.png"},message:"為您精選 ".concat(j.C.length," 個優質商品，涵蓋各種風格與需求。"),status:0}),p(m(j.C))},isSearching:e.isSearching,hasSearched:e.hasSearched,query:e.query})}),S&&e.hasSearched&&(0,r.jsx)("div",{className:"relative z-20 mt-4",children:(0,r.jsx)("div",{className:"container mx-auto px-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-start gap-6 py-8 flex-wrap",children:[(0,r.jsxs)("div",{className:"w-full max-w-[60%] flex items-start gap-4",children:[(0,r.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-sm flex items-center gap-3 w-fit flex-shrink-0",children:[S.intent.pic_url?(0,r.jsx)("div",{className:"w-12 h-12 rounded-lg overflow-hidden flex-shrink-0",children:(0,r.jsx)("img",{src:S.intent.pic_url,alt:S.intent.title,className:"w-full h-full object-cover"})}):(0,r.jsx)("div",{className:"w-12 h-12 flex items-center justify-center text-3xl",children:"\uD83E\uDDE5"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:S.intent.title})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-1.5 items-start max-h-[4.5rem] overflow-hidden relative flex-1",children:[S.intent.attrs.map((e,t)=>(0,r.jsx)("span",{className:"bg-white text-gray-700 text-xs px-2 py-0.5 rounded border border-gray-200 whitespace-nowrap",children:e},t)),(0,r.jsx)("div",{className:"absolute bottom-0 right-0 bg-gradient-to-l from-gray-50 via-gray-50 to-transparent pl-8 text-gray-500 text-xs",children:S.intent.attrs.length>12&&"..."})]})]}),(0,r.jsxs)("div",{className:"bg-white p-4 rounded-2xl shadow-sm max-w-[35%] min-w-[280px] text-sm text-gray-700 leading-relaxed flex gap-2",children:[(0,r.jsx)("span",{className:"text-sky-500 text-xl",children:"✨"}),(0,r.jsx)("p",{children:S.message?S.message:(0,r.jsx)("strong",{children:N[C]})})]})]})})}),e.hasSearched&&(0,r.jsx)("div",{className:"relative z-10 pt-2 pb-8",children:(0,r.jsx)("div",{className:"container mx-auto px-4",children:(0,r.jsx)(y,{products:x,isLoading:e.isSearching,searchQuery:e.query})})}),(0,r.jsx)("div",{className:"fixed bottom-0 left-0 right-0 h-24 pointer-events-none z-30 bg-gradient-to-t from-gray-100 via-gray-100/60 to-transparent"})]})]})}function O(){return(0,r.jsx)("main",{className:"min-h-screen bg-gradient-to-br from-gray-300 via-white to-gray-400",children:(0,r.jsx)(z,{})})}}},e=>{e.O(0,[55,741,909,441,964,358],()=>e(e.s=5628)),_N_E=e.O()}]);